<div class="container-fluid py-4">

  <h2 class="mb-3">Catálogo de Productos</h2>
  <p class="text-muted">Consulta los productos disponibles por tienda y color.</p>

  <!-- FILTROS -->
  <div class="card shadow mb-4">
    <div class="card-header bg-light d-flex justify-content-between align-items-center">
      <h6 class="m-0 font-weight-bold text-primary">Filtrar Productos</h6>
      <div>
        <button class="btn btn-secondary btn-sm me-2" (click)="clearFilters()">Limpiar</button>
        <button class="btn btn-primary btn-sm" (click)="applyFilters()">Aplicar</button>
      </div>
    </div>

    <div class="card-body">
      <div class="row">

        <div class="col-md-4">
          <label class="form-label">Nombre:</label>
          <input type="text" class="form-control" [(ngModel)]="filters.name">
        </div>

        <div class="col-md-4">
          <label class="form-label">Precio Máximo:</label>
          <input type="number" class="form-control" [(ngModel)]="filters.salePrice">
        </div>

        <div class="col-md-4">
          <label class="form-label">Categoría:</label>
          <select class="form-select" [(ngModel)]="filters.categoryId">
            <option value="">-- Todas --</option>
            <option *ngFor="let category of categories" [ngValue]="category.id">{{ category.name }}</option>
          </select>
        </div>

      </div>
    </div>
  </div>

  <!-- TABLA -->
  <div class="card shadow">
    <div class="card-header bg-light">
      <h6 class="m-0 font-weight-bold text-primary">Productos Disponibles</h6>
    </div>

    <div class="card-body" *ngIf="!loading">
      <div class="table-responsive">
        <table class="table table-bordered table-striped align-middle">
          <thead class="table-light">
            <tr>
              <th>Producto</th>
              <th>Categoría</th>
              <th>Precio</th>
              <th>Color</th>
              <th>Tienda</th>
              <th>Cantidad en Stock</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let stock of filteredStocks">
              <td>{{ stock.id.variation.product.name }}</td>
              <td>{{ stock.id.variation.product.category?.name }}</td>
              <td>{{ stock.id.variation.product.salePrice | currency }}</td>

              <td>
                <span class="badge px-3" [ngStyle]="{ 'background-color': stock.id.variation.color.hexCode}">
                  {{ stock.id.variation.color.name }}
                </span>
              </td>

              <td>{{ stock.id.store.name }}</td>
              <td>
                <span class="badge bg-success" *ngIf="stock.quantity > 0">{{ stock.quantity }}</span>
                <span class="badge bg-secondary" *ngIf="stock.quantity === 0">Agotado</span>
              </td>
            </tr>

            <tr *ngIf="filteredStocks.length === 0">
              <td colspan="6" class="text-center py-3 text-muted">No existen productos disponibles</td>
            </tr>

          </tbody>
        </table>
      </div>
    </div>

    <div *ngIf="loading" class="text-center py-4">
      <div class="spinner-border text-primary"></div>
    </div>

  </div>
</div>
